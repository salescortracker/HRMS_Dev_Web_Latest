<app-header></app-header>
<app-sidebar></app-sidebar>

<div class="dashboard-header">
  <h2 class="dashboard-title">Employee Immigration</h2>
  <nav class="breadcrumb">
    <a href="#">Home</a> &gt;
    <a href="#">Employee Profile</a> &gt;
    <span>Employee Immigration</span>
  </nav>
</div>

<!-- TAB 8: VISA / WORK PERMIT -->
<div class="tab-container">
  <!-- âœ… Added form reference and submit binding -->
  <form #immigrationForm="ngForm" (ngSubmit)="saveImmigration(immigrationForm)">
    <!-- Personal Details -->
    <div class="row mb-3">
      <div class="col-md-4">
        <label class="form-label">Full Name</label>
        <input type="text" class="form-control" name="fullName" [(ngModel)]="formModel.fullName" placeholder="Enter full name" required>
      </div>
      <div class="col-md-4">
        <label class="form-label">Employee ID / Code</label>
        <input type="text" class="form-control" name="employeeId" [(ngModel)]="formModel.employeeId" placeholder="Enter employee ID / code">
      </div>
      <div class="col-md-4">
        <label class="form-label">Date of Birth</label>
        <input type="date" class="form-control" name="dateOfBirth" [(ngModel)]="formModel.dateOfBirth" required>
      </div>
    </div>

    <div class="row mb-3">
      <div class="col-md-4">
        <label class="form-label">Nationality / Citizenship</label>
        <input type="text" class="form-control" name="nationality" [(ngModel)]="formModel.nationality" placeholder="Enter nationality" required>
      </div>
      <div class="col-md-4">
        <label class="form-label">Passport Number</label>
        <input type="text" class="form-control" name="passportNumber" [(ngModel)]="formModel.passportNumber" placeholder="Enter passport number" required>
      </div>
      <div class="col-md-4">
        <label class="form-label">Passport Expiry Date</label>
        <input type="date" class="form-control" name="passportExpiryDate" [(ngModel)]="formModel.passportExpiryDate" required>
      </div>
    </div>

    <!-- Visa / Work Permit Details -->
    <div class="row mb-3">
      <div class="col-md-4">
        <label class="form-label">Visa Type</label>
        <select class="form-select" name="visaType" [(ngModel)]="formModel.visaType" required>
          <option value="">Select Visa Type</option>
          <option>Work</option>
          <option>Study</option>
          <option>Dependent</option>
          <option>Temporary</option>
          <option>Permanent</option>
        </select>
      </div>
      <div class="col-md-4">
        <label class="form-label">Visa Number / Permit Number</label>
        <input type="text" class="form-control" name="visaNumber" [(ngModel)]="formModel.visaNumber" placeholder="Enter visa or permit number" required>
      </div>
      <div class="col-md-4">
        <label class="form-label">Visa Issuing Country</label>
        <input type="text" class="form-control" name="visaIssuingCountry" [(ngModel)]="formModel.visaIssuingCountry" placeholder="Enter issuing country" required>
      </div>
    </div>

    <div class="row mb-3">
      <div class="col-md-4">
        <label class="form-label">Visa Issue Date</label>
        <input type="date" class="form-control" name="visaIssueDate" [(ngModel)]="formModel.visaIssueDate" required>
      </div>
      <div class="col-md-4">
        <label class="form-label">Visa Expiry Date</label>
        <input type="date" class="form-control" name="visaExpiryDate" [(ngModel)]="formModel.visaExpiryDate" required>
      </div>
      <div class="col-md-4">
        <label class="form-label">Work Authorization / Permit Status</label>
        <select class="form-select" name="workAuthorizationStatus" [(ngModel)]="formModel.workAuthorizationStatus" required>
          <option value="">Select Status</option>
          <option>Approved</option>
          <option>Pending</option>
          <option>Rejected</option>
        </select>
      </div>
    </div>

    <!-- Employer / Sponsorship Details -->
    <div class="row mb-3">
      <div class="col-md-4">
        <label class="form-label">Employer / Sponsor Name</label>
        <input type="text" class="form-control" name="employerName" [(ngModel)]="formModel.employerName" placeholder="Enter employer or sponsor name" required>
      </div>
      <div class="col-md-4">
        <label class="form-label">Employer Address</label>
        <input type="text" class="form-control" name="employerAddress" [(ngModel)]="formModel.employerAddress" placeholder="Enter employer address" required>
      </div>
      <div class="col-md-4">
        <label class="form-label">Contact Person / HR</label>
        <input type="text" class="form-control" name="contactPerson" [(ngModel)]="formModel.contactPerson" placeholder="Enter HR contact name" required>
      </div>
    </div>

    <div class="row mb-3">
      <div class="col-md-4">
        <label class="form-label">Employer Contact Email / Phone</label>
        <input type="text" class="form-control" name="employerContact" [(ngModel)]="formModel.employerContact" placeholder="Enter email or phone" required>
      </div>
      <div class="col-md-8">
        <label class="form-label">Remarks / Additional Information</label>
        <textarea class="form-control" name="remarks" [(ngModel)]="formModel.remarks" placeholder="Any additional info (optional)"></textarea>
      </div>
    </div>

    <!-- Upload Documents -->
    <div class="row mb-3">
      <div class="col-md-4">
        <label class="form-label">Passport Copy</label>
        <input type="file" class="form-control" (change)="onFileChange($event, 'passportCopy')">
      </div>
      <div class="col-md-4">
        <label class="form-label">Visa / Work Permit Copy</label>
        <input type="file" class="form-control" (change)="onFileChange($event, 'visaCopy')">
      </div>
      <div class="col-md-4">
        <label class="form-label">Other Supporting Documents</label>
        <input type="file" class="form-control" (change)="onFileChange($event, 'otherDocs')">
      </div>
    </div>

    <div class="row mb-3">
      <div class="col-md-12 text-first">
        <button type="submit" class="btn btn-primary">
          {{ isEditMode ? 'Update Visa / Work Permit' : 'Save Visa / Work Permit' }}
        </button>
        <button type="button" class="btn btn-secondary ms-2" (click)="resetForm(immigrationForm)">
          Reset
        </button>
      </div>
    </div>
  </form>

  <!-- List Table -->
  <div class="dashboard-tables full-row mt-4">
    <div class="table-card">
      <h3>Visa / Work Permit List</h3>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>Employee</th>
            <th>Visa Type</th>
            <th>Visa Number</th>
            <th>Issue Date</th>
            <th>Expiry Date</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of immigrationList">
            <td>{{ item.employeeId }} - {{ item.fullName }}</td>
            <td>{{ item.visaType }}</td>
            <td>{{ item.visaNumber }}</td>
            <td>{{ item.visaIssueDate | date: 'yyyy-MM-dd' }}</td>
            <td>{{ item.visaExpiryDate | date: 'yyyy-MM-dd' }}</td>
            <td>{{ item.workAuthorizationStatus }}</td>
            <td class="action-icons">
              <i class="fa-solid fa-pen" (click)="editImmigration(item)" title="Edit"></i>
              <i class="fa-solid fa-trash" (click)="deleteImmigration(item.immigrationId)" title="Delete"></i>
            </td>
          </tr>
          <tr *ngIf="immigrationList.length === 0">
            <td colspan="7" class="text-center text-muted">No records found</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<app-footer></app-footer>
