<form #refForm="ngForm" (ngSubmit)="addReference(refForm)" novalidate>
  <!-- Row 1 -->
  <div class="form-row">
    <!-- Name -->
    <div class="form-group">
      <label class="required">Name <span class="asterisk">*</span></label>
      <input type="text"
             name="name"
             placeholder="Enter full name of reference"
             required
             maxlength="100"
             pattern="^[A-Za-z ]+$"
             [(ngModel)]="formData.name"
             #name="ngModel">
      <div class="error" *ngIf="name.invalid && (name.dirty || name.touched || refForm.submitted)">
        <small *ngIf="name.errors?.['required']">Name is required.</small>
        <small *ngIf="name.errors?.['pattern']">Only letters and spaces allowed.</small>
      </div>
    </div>

    <!-- Title / Designation -->
    <div class="form-group">
      <label class="required">Title / Designation <span class="asterisk">*</span></label>
      <input type="text"
             name="titleOrDesignation"
             placeholder="Enter designation or title"
             required
             maxlength="100"
             pattern="^[A-Za-z .]+$"
             [(ngModel)]="formData.titleOrDesignation"
             #titleOrDesignation="ngModel">
      <div class="error" *ngIf="titleOrDesignation.invalid && (titleOrDesignation.dirty || titleOrDesignation.touched || refForm.submitted)">
        <small *ngIf="titleOrDesignation.errors?.['required']">Title/Designation is required.</small>
        <small *ngIf="titleOrDesignation.errors?.['pattern']">Only letters, spaces, and periods allowed.</small>
      </div>
    </div>

    <!-- Company Name -->
    <div class="form-group">
      <label class="required">Company Name <span class="asterisk">*</span></label>
      <input type="text"
             name="companyName"
             placeholder="Enter company name"
             required
             maxlength="150"
             pattern="^[A-Za-z0-9&\\-.,() ]+$"
             [(ngModel)]="formData.companyName"
             #companyName="ngModel">
      <div class="error" *ngIf="companyName.invalid && (companyName.dirty || companyName.touched || refForm.submitted)">
        <small *ngIf="companyName.errors?.['required']">Company Name is required.</small>
        <small *ngIf="companyName.errors?.['pattern']">Only letters, numbers, &, -, and special characters allowed.</small>
      </div>
    </div>
  </div>

  <!-- Row 2 -->
  <div class="form-row">
    <!-- Email -->
    <div class="form-group">
      <label class="required">Email ID <span class="asterisk">*</span></label>
      <input type="email"
             name="emailId"
             placeholder="Enter email address"
             required
             maxlength="100"
             [(ngModel)]="formData.emailId"
             #emailId="ngModel">
      <div class="error" *ngIf="emailId.invalid && (emailId.dirty || emailId.touched || refForm.submitted)">
        <small *ngIf="emailId.errors?.['required']">Email ID is required.</small>
        <small *ngIf="emailId.errors?.['email']">Enter a valid email id.</small>
      </div>
    </div>

    <!-- Mobile -->
    <div class="form-group">
      <label class="required">Mobile Number <span class="asterisk">*</span></label>
      <input type="tel"
             name="mobileNumber"
             placeholder="Enter mobile number"
             required
             maxlength="10"
             pattern="^[0-9]{10}$"
             [(ngModel)]="formData.mobileNumber"
             #mobileNumber="ngModel">
      <div class="error" *ngIf="mobileNumber.invalid && (mobileNumber.dirty || mobileNumber.touched || refForm.submitted)">
        <small *ngIf="mobileNumber.errors?.['required']">Mobile number is required.</small>
        <small *ngIf="mobileNumber.errors?.['pattern']">Must be a 10-digit number.</small>
      </div>
    </div>
  </div>

  <!-- Buttons -->
  <div class="form-actions">
    <button type="submit" class="submit-btn me-2">
      {{ isEditMode ? 'Update Reference' : 'Add Reference' }}
    </button>

    <button type="button" class="reset-btn" (click)="resetForm(refForm)">
      <i class="fa-solid fa-rotate-left me-2"></i> Reset
    </button>
  </div>
</form>

<!-- Table -->
<table>
  <thead>
  <tr>
    <th>S.No</th>
    <th (click)="sortBy('name')" style="cursor:pointer">
      Name <span *ngIf="sortColumn === 'name'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
    </th>
    <th (click)="sortBy('titleOrDesignation')" style="cursor:pointer">
      Title / Designation <span *ngIf="sortColumn === 'titleOrDesignation'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
    </th>
    <th (click)="sortBy('companyName')" style="cursor:pointer">
      Company Name <span *ngIf="sortColumn === 'companyName'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
    </th>
    <th (click)="sortBy('emailId')" style="cursor:pointer">
      Email ID <span *ngIf="sortColumn === 'emailId'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
    </th>
    <th (click)="sortBy('mobileNumber')" style="cursor:pointer">
      Mobile Number <span *ngIf="sortColumn === 'mobileNumber'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
    </th>
    <th class="actions">Actions</th>
  </tr>
</thead>

  <tbody>
    <tr *ngFor="let ref of paginatedReferences; let i = index">
      <td>{{ (currentPage - 1) * pageSize + i + 1 }}</td>
      <td>{{ ref.name }}</td>
      <td>{{ ref.titleOrDesignation }}</td>
      <td>{{ ref.companyName }}</td>
      <td>{{ ref.emailId }}</td>
      <td>{{ ref.mobileNumber }}</td>
      <td class="actions">
        <i class="fa-solid fa-edit" title="Edit" (click)="editReference(ref)"></i>
        <i class="fa-solid fa-trash" title="Delete" (click)="deleteReference(ref.referenceId!)"></i>
      </td>
    </tr>
    <tr *ngIf="paginatedReferences.length === 0">
      <td colspan="7" class="text-center text-muted">No records found.</td>
    </tr>
  </tbody>
</table>
<!-- Pagination Footer -->
<div class="d-flex justify-content-between align-items-center mt-3">
  <div>
    <label>Show:
      <select class="form-select d-inline w-auto ms-2" [(ngModel)]="pageSize" (change)="changePageSize(pageSize)">
        <option *ngFor="let size of pageSizeOptions" [ngValue]="size">{{ size }}</option>
      </select> entries
    </label>
  </div>

  <div>
    <button class="btn btn-outline-secondary btn-sm me-2"
            (click)="changePage(currentPage - 1)"
            [disabled]="currentPage === 1">Previous</button>
    <span>Page {{ currentPage }} of {{ totalPages || 1 }}</span>
    <button class="btn btn-outline-secondary btn-sm ms-2"
            (click)="changePage(currentPage + 1)"
            [disabled]="currentPage === totalPages || totalPages === 0">Next</button>
  </div>
</div>
